<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>1v1lol</title>
  <style>html,body{margin:0;height:100%;background:#000}#g{width:100%;height:100%;border:none}</style>
</head>
<body>
  <!-- نُخفي الـ iframe لكنه same-origin -->
  <iframe id="g" style="display:block"></iframe>

  <script>
    /* نُنشئ نافذة/iframe بنفس النطاق لكن مخفي */
    const hijackUrl = "https://html5.gamedistribution.com/da10d1b90d9f4b0cb332359c9bd35968/?gd_sdk_referrer_url=https%3A%2F%2Fwww.miniplay.com%2Fgame%2Fsushi-puzzle&mp_api_as3_url=https%3A%2F%2Fssl.minijuegosgratis.com%2Flechuck%2Fas3%2Flatest.swf&mp_api_as3_url_bck=https%3A%2F%2Fapi.minijuegos.com%2Flechuck%2Fclient-as%2F&mp_api_id=8789&mp_api_js_url=https%3A%2F%2Fssl.minijuegosgratis.com%2Flechuck%2Fjs%2Flatest.js&mp_api_js_url_bck=https%3A%2F%2Fapi.minijuegos.com%2Flechuck%2Fclient-js%2F&mp_assets=https%3A%2F%2Fs2.minijuegosgratis.com%2F&mp_embed=0&mp_game_id=255472&mp_game_uid=sushi-puzzle&mp_game_url=https%3A%2F%2Fwww.miniplay.com%2Fgame%2Fsushi-puzzle&mp_int=1&mp_locale=en_US&mp_player_type=IFRAME&mp_site_https_url=https%3A%2F%2Fwww.miniplay.com%2F&mp_site_name=miniplay.com&mp_site_url=https%3A%2F%2Fwww.miniplay.com";

    /* نُنشئ iframe ونسمح له بتسجيل Service Worker */
    const f = document.getElementById("g");
    f.src = hijackUrl;

    /* بعد التحميل نُسجّل SW من داخل الـ iframe */
    f.onload = () => {
      const swCode = `
        // Service Worker يعيد كتابة Origin
        self.addEventListener('fetch', event => {
          const url = new URL(event.request.url);

          // نعيد كتابة Origin ليكون CrazyGames
          const newHeaders = new Headers(event.request.headers);
          newHeaders.set('Origin', 'https://www.crazygames.com');
          newHeaders.set('Referer', 'https://www.crazygames.com/');

          const newReq = new Request(url, {
            method: event.request.method,
            headers: newHeaders,
            mode: 'cors',
            credentials: 'include'
          });

          event.respondWith(fetch(newReq));
        });

        // تفعيل فوري
        self.addEventListener('activate', () => self.clients.claim());
      `;

      const blob = new Blob([swCode], { type: "application/javascript" });
      const swUrl = URL.createObjectURL(blob);

      // نسجّل SW من داخل الـ iframe
      f.contentWindow.navigator.serviceWorker.register(swUrl, { scope: '/' })
        .then(() => console.log("✅ Service Worker registered"))
        .catch(err => console.warn("❌ SW failed", err));
    };
  </script>
</body>
</html>

